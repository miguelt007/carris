<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mapa Carris Metropolitana - Simulado</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin="anonymous"
  />
  <style>
    html, body {
      margin: 0;
      height: 100%;
    }
    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>
  <script>
    const map = L.map("map").setView([38.736946, -9.142685], 12);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "Â© OpenStreetMap contributors"
    }).addTo(map);

    // SimulaÃ§Ã£o de um autocarro ativo
    const autocarroSimulado = {
      id: "sim|999",
      lat: 38.7369,
      lon: -9.1427,
      line_id: "4000",
      speed: 12.5,
      bearing: 82,
      current_status: "IN_TRANSIT_TO",
      pattern_id: "4000_0_1",
      timestamp: Math.floor(Date.now() / 1000)
    };

    function traduzirStatus(status) {
      switch (status) {
        case "INCOMING_AT": return "A chegar Ã  paragem";
        case "STOPPED_AT": return "Parado na paragem";
        case "IN_TRANSIT_TO": return "Em trÃ¢nsito";
        default: return "Desconhecido";
      }
    }

    const {
      lat, lon, id, line_id, speed,
      bearing, current_status, pattern_id,
      timestamp
    } = autocarroSimulado;

    const velocidadeKmH = Math.round(speed * 3.6);
    const direcao = Math.round(bearing) + "Â°";
    const estado = traduzirStatus(current_status);
    const hora = new Date(timestamp * 1000).toLocaleTimeString("pt-PT");

    const marcador = L.marker([lat, lon]).addTo(map);
    marcador.bindPopup(`
      ðŸšŒ <strong>Autocarro ${id}</strong><br>
      Linha: ${line_id}<br>
      Velocidade: ${velocidadeKmH} km/h<br>
      DireÃ§Ã£o: ${direcao}<br>
      Estado: ${estado}<br>
      Percurso: ${pattern_id}<br>
      AtualizaÃ§Ã£o: ${hora}
    `);
  </script>
</body>
</html>
