<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carris Metropolitana – Teste Mapa</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
html, body { margin:0; height:100%; }
#map { height:100%; width:100%; }
.bus-container {
  display:flex; align-items:center;
}
.bus-rect {
  background:#FFD100; color:black; font-weight:bold; padding:0 6px; border-radius:4px;
  display:flex; align-items:center; justify-content:center;
  height:30px; white-space:nowrap;
}
.bus-arrow {
  width:0; height:0; border-left:6px solid transparent; border-right:6px solid transparent;
  border-bottom:10px solid black; margin-left:4px;
}
</style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/gh/bbecquet/Leaflet.RotatedMarker@master/leaflet.rotatedMarker.js"></script>
<script>
// Inicializar mapa
const map = L.map('map').setView([38.736946, -9.142685], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'© OpenStreetMap contributors'
}).addTo(map);

// Função para criar ícone retangular giratório
function createBusIcon(line, bearing){
  return L.divIcon({
    className:'bus-wrapper',
    html:`<div class="bus-container" style="transform: rotate(${bearing||0}deg)">
      <div class="bus-rect">${line}</div>
      <div class="bus-arrow"></div>
    </div>`,
    iconSize:[50,30],
    iconAnchor:[10,15]
  });
}

// Marcadores de teste
const testeBuses = [
  {lat:38.737, lon:-9.142, line:"4701", bearing:45},
  {lat:38.741, lon:-9.148, line:"7201", bearing:120},
  {lat:38.730, lon:-9.135, line:"1", bearing:270},
];

testeBuses.forEach(bus=>{
  L.marker([bus.lat,bus.lon],{icon:createBusIcon(bus.line,bus.bearing)}).addTo(map)
    .bindPopup(`Autocarro ${bus.line}, Bearing: ${bus.bearing}°`);
});
</script>

</body>
</html>
